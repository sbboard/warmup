var imgNum=0,uploadedImages=[],minutes=10,minutesDupe=10,timeCalc=0,fileTag=document.getElementById("filetag"),minPerImg=document.getElementById("minPerImg"),currentImg=-1,nextSFX=document.getElementById("nextSFX"),musicVolume=.2;nextSFX.volume=musicVolume;var paused=!1,timeLeft=0,noTimerLast=!1,btnOpacityOff=0;function changeMinPerImg(e){0<e.value.length?parseInt(e.value)<1?e.value="1":25<parseInt(e.value)?e.value="25":(minutes=parseInt(e.value),minutesDupe=parseInt(e.value),timeCalc=imgNum*parseInt(e.value),document.getElementById("totalTime").innerHTML=timeCalc.toString()):document.getElementById("totalTime").innerHTML="0"}function clearQueue(){document.getElementById("queueNum").innerHTML="0",uploadedImages=[],imgNum=0,document.getElementById("thumbnails").innerHTML="",changeMinPerImg(minPerImg)}function changePauseEnd(e){noTimerLast=e.checked}var currentDown=null;function moving(e){null!=currentDown&&(e.preventDefault(),currentDown.classList.add("dragged"),changeX(currentDown.dataset.made,btnOpacityOff),currentDown.style.left=e.clientX-10+"px",currentDown.style.top=e.clientY-10+"px")}function arraymove(e,n,t){var m=e[n];e.splice(n,1),e.splice(t,0,m)}function mouseUp(e){if(null!=currentDown){var n=parseInt(currentDown.dataset.made);currentDown.classList.remove("dragged"),currentDown=null;for(var t=e.clientX,m=0;uploadedImages.length>m;m++){if(m!=n)if(document.querySelectorAll('[data-made="'+m.toString()+'"]')[0].getBoundingClientRect().right>t){arraymove(uploadedImages,n,m),renderThumbs();break}m==uploadedImages.length-1&&(arraymove(uploadedImages,n,uploadedImages.length-1),renderThumbs())}}}function renderThumbs(){document.getElementById("thumbnails").innerHTML="",uploadedImages.map(function(e,n){var t=document.createElement("img"),m=document.createElement("img");t.src=e.blob,t.dataset.made=n.toString(),t.onmouseenter=function(){null===currentDown&&changeX(n,"1")},t.onmouseout=function(){changeX(n,btnOpacityOff)},t.onmousedown=function(){currentDown=event.target},t.onmousemove=function(){return moving(event)},m.src="./x-btn.png",m.dataset.btnno=n.toString(),m.classList.add("xBtn"),m.onclick=function(){return killThumb(n)},m.onmouseenter=function(){null===currentDown&&changeX(n,"1")},m.onmouseout=function(){changeX(n,btnOpacityOff)},document.getElementById("thumbnails").appendChild(m),document.getElementById("thumbnails").appendChild(t)})}function changeX(e,n){document.querySelectorAll('[data-btnno="'+e.toString()+'"]')[0].style.opacity=n}function killThumb(e){uploadedImages.splice(e,1),document.getElementById("queueNum").innerHTML=uploadedImages.length.toString(),imgNum=uploadedImages.length,changeMinPerImg(minPerImg),renderThumbs()}function changeImage(m){if(m.files){imgNum+=m.files.length;for(var e=0;e<m.files.length;e++)!function(e){var n=new FileReader,t=m.files[e].name;n.onload=function(e){uploadedImages.push({name:t,blob:e.target.result}),renderThumbs()},n.readAsDataURL(m.files[e])}(e);document.getElementById("queueNum").innerHTML=imgNum.toString(),changeMinPerImg(minPerImg),m.value=""}}function startApp(){var e;0<timeCalc?(window.removeEventListener("mousemove",moving),window.removeEventListener("mouseup",mouseUp),document.getElementById("app").innerHTML="",(e=document.createElement("img")).id="galleryImg",document.getElementById("app").appendChild(e),(e=document.createElement("span")).innerHTML=new Date(60*minutes*1e3).toISOString().substr(14,5).toString(),e.id="timer",document.getElementById("app").appendChild(e),(e=document.createElement("span")).id="imgName",document.getElementById("app").appendChild(e),(e=document.createElement("span")).innerHTML=currentImg+1+"/"+uploadedImages.length,e.id="theCount",document.getElementById("app").appendChild(e),(e=document.createElement("button")).innerHTML="skip",e.addEventListener("click",skipImg),e.id="skipBtn",document.getElementById("app").appendChild(e),(e=document.createElement("button")).innerHTML="pause timer",e.addEventListener("click",addFive),e.id="addFive",document.getElementById("app").appendChild(e),nextImg()):imgNum<1?alert("Upload Images First"):alert("Timer set to 0")}window.addEventListener("mousemove",moving),window.addEventListener("mouseup",mouseUp);var skipped=!1;function skipImg(){skipped=!0}function addFive(){var e=document.getElementById("addFive"),n=document.getElementById("skipBtn");0==paused?(paused=!0,e.innerHTML="start timer",e.disabled=!0,n.disabled=!0):(startTimer(),paused=!1,e.innerHTML="pause timer",e.disabled=!0,n.disabled=!1)}function startTimer(){var n=document.getElementById("timer"),t=60*minutes;var m=setInterval(function downTick(){var e;document.getElementById("addFive").disabled=!1,0==skipped?1==paused?(minutes=t/60,clearInterval(m)):(t-=1,n.innerHTML=new Date(1e3*t).toISOString().substr(14,5).toString(),60==t?((e=document.getElementById("oneMin")).volume=musicVolume,e.play()):t<=3&&0!=t&&((e=document.getElementById("tok")).volume=musicVolume,e.play())):(skipped=!1,explosion()),0==t&&explosion()},1e3);function explosion(){minutes=minutesDupe,clearInterval(m),function timerOut(){currentImg+1!=uploadedImages.length?(n.innerHTML=new Date(60*minutes*1e3).toISOString().substr(14,5).toString(),nextImg()):finish()}()}}function finish(){var e=document.createElement("div");e.id="endScreen",e.innerHTML="GOOD WARM-UP!",document.getElementById("app").innerHTML="",document.getElementById("app").appendChild(e);e=document.getElementById("endMusic");e.volume=musicVolume,e.play()}function nextImg(){currentImg++;var e=document.getElementById("theCount"),n=document.getElementById("skipBtn"),t=uploadedImages[currentImg];e.innerHTML=currentImg+1+"/"+uploadedImages.length;var m=document.getElementById("galleryImg"),e=document.getElementById("imgName");m.src=t.blob,e.innerHTML=t.name,nextSFX.play(),currentImg+1==uploadedImages.length&&(n.innerHTML="finish"),!0===noTimerLast&&currentImg+1==uploadedImages.length?(n.removeEventListener("click",skipImg),n.addEventListener("click",finish),document.getElementById("addFive").disabled=!0):startTimer()}